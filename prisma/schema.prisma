// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ğŸ›’ ç”¢å“è£å‚™è¡¨ (The Armory)
model Product {
  // ID: ä½¿ç”¨ UUID (ä¾‹å¦‚: "PROD_001_A_JKT" æˆ–è‡ªå‹•ç”Ÿæˆçš„äº‚ç¢¼)
  id           String   @id @default(uuid())
  
  // æ ¸å¿ƒæ¬„ä½ (ç”¨ä¾†æœå°‹ã€æ’åºã€ç¯©é¸)
  title        String
  category     String   @default("Uncategorized")
  price        Int      @default(0)
  is_published Boolean  @default(true) // ä¸Šæ¶ç‹€æ…‹
  
  // åœ–ç‰‡ç‰† (å„²å­˜ GCS çš„ç¶²å€é™£åˆ—)
  images       String[] 
  
  // ğŸ“¦ è¤‡é›œè³‡æ–™ (JSONB)ï¼šé€™è£¡å­˜æ”¾ basic_info, rpg_tuning, inventory ç­‰æ‰€æœ‰ç´°ç¯€
  // é€™æ¨£ä½ å°±ä¸ç”¨æ”¹åŸæœ¬çš„å‰ç«¯çµæ§‹ï¼Œç›´æ¥æŠŠæ•´åŒ… JSON å¡é€²ä¾†å³å¯ï¼
  details      Json?

  // æ™‚é–“æˆ³è¨˜
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  orderItems  OrderItem[]
}

// ğŸ›¡ï¸ ä½¿ç”¨è€…/ç®¡ç†å“¡è¡¨ (The Guild Members)
// æœªä¾†åšç™»å…¥é©—è­‰æ™‚æœƒç”¨åˆ°
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String   // åŠ å¯†å¾Œçš„å¯†ç¢¼
  role      Role     @default(USER)
  createdAt DateTime @default(now())

  resetPasswordToken   String?
  resetPasswordExpires DateTime?

  addresses            Address[]
  orders               Order[]
}

enum Role {
  USER
  ADMIN
  MERCHANT
}

model Address {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  
  recipient String   // æ”¶ä»¶äººå§“å (å†’éšªè€…ä»£è™Ÿ)
  phone     String   // è¯çµ¡é›»è©± (æ°´æ™¶çƒé€šè¨Šç¢¼)
  city      String   // åŸå¸‚ (ex: ç‹éƒ½)
  district  String   // å€åŸŸ (ex: å•†æ¥­å€)
  detail    String   // è©³ç´°åœ°å€ (ex: éµåŒ é‹ªæ—å··å­)
  
  createdAt DateTime @default(now())
}

model Order {
  id        String      @id @default(uuid())
  userId    String
  user      User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  status    OrderStatus @default(PENDING) // è¨‚å–®ç‹€æ…‹
  total     Int         @default(0)       // ç¸½é‡‘é¡
  
  items     OrderItem[] // è²·äº†å“ªäº›æ±è¥¿
  
  createdAt DateTime    @default(now())
}

model OrderItem {
  id        String  @id @default(uuid())
  orderId   String
  order     Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  
  productId String
  product   Product @relation(fields: [productId], references: [id])
  
  quantity  Int     @default(1) // è²·äº†å¹¾å€‹
  price     Int     // è³¼è²·ç•¶æ™‚çš„å–®åƒ¹ (é¿å…å•†å“æ¼²åƒ¹å¾Œè¨‚å–®é‡‘é¡è®Šå‹•)
}

enum OrderStatus {
  PENDING   // è™•ç†ä¸­
  PAID      // å·²ä»˜æ¬¾
  SHIPPED   // å·²å‡ºè²¨
  COMPLETED // å·²å®Œæˆ
  CANCELLED // å·²å–æ¶ˆ
}